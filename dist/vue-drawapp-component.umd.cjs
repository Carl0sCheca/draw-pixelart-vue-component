(function(q,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],H):(q=typeof globalThis<"u"?globalThis:q||self,H(q.VueDrawAppComponent={},q.Vue))})(this,function(q,H){"use strict";class et{constructor(t,s){this.drawApp=t,this.toolType=s,this.name=this.toolType.toString(),this.event=new Event(this.name),this._dragging=!1,this.canRun=!0,t.canvas.addEventListener(this.name,()=>this.onAction())}onAction(){this.canRun=this.drawApp.mouse.button!==d.RIGHT}}function y(n,t){return t.some(s=>s.x===n.x&&s.y===n.y)?!0:(t.push(n),!1)}function L(n){const t=new Blob([n],{type:"image/svg+xml"}),s=URL.createObjectURL(t),r=document.createElement("img");return r.src=s,r}function at(n,t,s){if(X(n,{x:0,y:0},{x:t.settings.gridSize-1,y:t.settings.gridSize-1})){if(n.x+1<t.settings.gridSize&&!s.some(r=>r.x-1===n.x&&r.y===n.y)){const r={x:n.x+1,y:n.y};y(r,s),at(r,t,s)}if(n.x-1>=0&&!s.some(r=>r.x+1===n.x&&r.y===n.y)){const r={x:n.x-1,y:n.y};y(r,s),at(r,t,s)}if(n.y+1<t.settings.gridSize&&!s.some(r=>r.x===n.x&&r.y-1===n.y)){const r={x:n.x,y:n.y+1};y(r,s),at(r,t,s)}if(n.y-1>=0&&!s.some(r=>r.x===n.x&&r.y+1===n.y)){const r={x:n.x,y:n.y-1};y(r,s),at(r,t,s)}}}function lt(n,t,s,r){if(X(n,{x:0,y:0},{x:t.settings.gridSize-1,y:t.settings.gridSize-1})){if(n.x+1<t.settings.gridSize&&t.data.pixels[n.x+1][n.y]===r&&!s.some(a=>a.x-1===n.x&&a.y===n.y)){const a={x:n.x+1,y:n.y};y(a,s),lt(a,t,s,r)}if(n.x-1>=0&&t.data.pixels[n.x-1][n.y]===r&&!s.some(a=>a.x+1===n.x&&a.y===n.y)){const a={x:n.x-1,y:n.y};y(a,s),lt(a,t,s,r)}if(n.y+1<t.settings.gridSize&&t.data.pixels[n.x][n.y+1]===r&&!s.some(a=>a.x===n.x&&a.y-1===n.y)){const a={x:n.x,y:n.y+1};y(a,s),lt(a,t,s,r)}if(n.y-1>=0&&t.data.pixels[n.x][n.y-1]===r&&!s.some(a=>a.x===n.x&&a.y+1===n.y)){const a={x:n.x,y:n.y-1};y(a,s),lt(a,t,s,r)}}}function zi(n){return!(n.mouse.dataPosition.x<0||n.mouse.dataPosition.x>=n.settings.gridSize||n.mouse.dataPosition.y<0||n.mouse.dataPosition.y>=n.settings.gridSize||n.mouse.position.x<0||n.mouse.position.x>=n.canvas.width||n.mouse.position.y<0||n.mouse.position.y>=n.canvas.height)}function Oi(n){return{x:Math.trunc(-n.zoom.offset.x/n.zoom.level),y:Math.trunc(-n.zoom.offset.y/n.zoom.level)}}function Ni(n){return{x:Math.trunc((n.canvas.width-n.zoom.offset.x)/n.zoom.level),y:Math.trunc((n.canvas.height-n.zoom.offset.y)/n.zoom.level)}}function jt(n,t){return n.x!==t.x||n.y!==t.y}const Dt={x:0,y:0};function Kt(n,t){return{x:n.x/t.x,y:n.y/t.x}}function Jt(n){return{x:Math.abs(n.x),y:Math.abs(n.y)}}function Mi(n){return{x:Math.trunc(n.x),y:Math.trunc(n.y)}}function bi(n){return{x:Math.ceil(n.x),y:Math.ceil(n.y)}}function C(n,t,s){return n<t?t:n>s?s:n}function Li(n,t,s){return{x:C(n.x,t.x,s.x),y:C(n.y,t.y,s.y)}}function st(n,t){return{x:n.x*t.settings.pixelSize,y:n.y*t.settings.pixelSize}}function ot(n,t){return{x:C(Math.trunc(n.x/t.settings.pixelSize),0,t.settings.gridSize-1),y:C(Math.trunc(n.y/t.settings.pixelSize),0,t.settings.gridSize-1)}}function Qt(n,t,s){return(1-s)*n+s*t}function Di(n,t,s,r){if(!zi(n))return;const a=ot(t,n),c=ot(s,n),w=1/Math.max(Math.trunc(Math.abs(a.x-c.x)),Math.trunc(Math.abs(a.y-c.y)));for(let v=w;v<=1;v+=w){const T={x:Math.trunc(Qt(c.x,a.x,v)),y:Math.trunc(Qt(c.y,a.y,v))};r(T)}}function Ri(n,t){return Math.floor(Math.random()*(t-n+1))+n}function X(n,t,s){return n.x>=t.x&&n.x<=s.x&&n.y>=t.y&&n.y<=s.y}function xt(n){const t={H:n.H,S:n.S/100,V:n.V/100},s={H:t.H,S:void 0,L:void 0};return s.L=t.V*(1-t.S/2),s.L===0||s.L===1?s.S=0:s.S=(t.V-s.L)/Math.min(s.L,1-s.L),s.L=Math.ceil(s.L*100),s.S=Math.ceil(s.S*100),s}function mt(n){return`hsl(${n.H}, ${n.S}%, ${n.L}%)`}function Ui(n){let t="#";for(let s=0;s<3;s++){let r=n[s].toString(16);r.length===1&&(r="0"+r),t+=r}return t}var N;(function(n){n[n.Vector=0]="Vector",n[n.Array=1]="Array"})(N||(N={}));class $t{constructor(t,s){this._drawApp=t,this._gridSize=s,this._initData()}_initData(t="ffffff"){let s=!1;if(typeof Storage!==void 0&&localStorage.pixels){const r=JSON.parse(localStorage.pixels);r.length===parseInt(this._gridSize)&&(this.pixels=r,s=!0)}if(!s){this.pixels=[];for(let r=0;r<this._gridSize;r++){this.pixels[r]=[];for(let a=0;a<this._gridSize;a++)this.pixels[r][a]=t}}this.lastAction=[],this.lastActionIndex=-1}saveLocalStorage(){typeof Storage!==void 0&&(localStorage.pixels=JSON.stringify(this.pixels))}clearData(t="ffffff"){var s,r;const a={positions:[],colors:[],type:N.Array};for(let c=0;c<this._gridSize;c++)for(let u=0;u<this._gridSize;u++)(s=a.positions)===null||s===void 0||s.push({x:c,y:u}),(r=a.colors)===null||r===void 0||r.push(this.pixels[c][u]),this.pixels[c][u]=t;this._checkLastActionAndWrite(a),this.saveLocalStorage()}static FlushDuplicatedData(t,s){var r;const a=[];for(let c=0;c<s;c++)a[c]=[];(r=t.positions)===null||r===void 0||r.forEach((c,u)=>{X(c,{x:0,y:0},{x:s-1,y:s-1})&&(a[c.x][c.y]=t.colors[u])}),t.positions=[],t.colors=[];for(let c=0;c<s;c++)for(let u=0;u<s;u++)a[c][u]!==void 0&&(t.positions.push({x:c,y:u}),t.colors.push(a[c][u]));return t}_checkLastActionAndWrite(t){this.lastActionIndex+1!==this.lastAction.length&&this.lastAction.splice(this.lastActionIndex+1),this.lastAction[this.lastActionIndex+1]!==void 0?this.lastAction[this.lastActionIndex+1]=t:this.lastAction.push(t),this.lastActionIndex++}writeData(t){var s,r;if(this.pixels!==void 0||t!==void 0){if(t.type===N.Vector)this._checkPixelAndPaint(t.position,t.color);else if(t.type===N.Array){const a={positions:[],colors:[],type:N.Array};(s=t.positions)===null||s===void 0||s.forEach(c=>{var u,w;X(c,{x:0,y:0},{x:this._gridSize-1,y:this._gridSize-1})&&((u=a.positions)===null||u===void 0||u.push({x:c.x,y:c.y}),(w=a.colors)===null||w===void 0||w.push(this.pixels[c.x][c.y]))}),this._checkLastActionAndWrite(a),(r=t.positions)===null||r===void 0||r.forEach((c,u)=>{if(c!==null){const w=t.color?t.color:t.colors[u];this._checkPixelAndPaint(c,w)}})}this.saveLocalStorage()}}_checkPixelAndPaint(t,s){X(t,{x:0,y:0},{x:this._gridSize-1,y:this._gridSize-1})&&(this._drawApp.ctx.fillStyle=s,this.pixels[C(t.x,0,this._gridSize-1)][C(t.y,0,this._gridSize-1)]=this._drawApp.ctx.fillStyle.substr(1))}canUndo(){return this.lastActionIndex>=0}undo(){var t;if(this.canUndo()){const s=this.lastAction[this.lastActionIndex];this.lastActionIndex--;const r=[],a=[];(t=s.positions)===null||t===void 0||t.forEach((c,u)=>{r.push(c),a.push(this.pixels[c.x][c.y]),this.pixels[c.x][c.y]=s.colors[u]}),this.lastAction[this.lastActionIndex+1]={positions:r,colors:a,type:N.Array},this.saveLocalStorage()}}canRedo(){return this.lastActionIndex+1<this.lastAction.length}redo(){var t;if(this.canRedo()){this.lastActionIndex++;const s=this.lastAction[this.lastActionIndex],r=[],a=[];(t=s.positions)===null||t===void 0||t.forEach((c,u)=>{r.push(c),a.push(this.pixels[c.x][c.y]),this.pixels[c.x][c.y]=s.colors[u]}),this.lastAction[this.lastActionIndex]={positions:r,colors:a,type:N.Array},this.saveLocalStorage()}}}class ti extends et{constructor(t,s){super(t,s),this.rainbow=!1,this.size=1,this._pixelPoints={positions:[],colors:[],type:N.Array}}onAction(){super.onAction(),this.canRun&&(this.drawApp.mouse.button===d.LEFT?this._dragging?jt(this.drawApp.mouse.position,this.drawApp.mouse.lastPosition)&&Di(this.drawApp,this.drawApp.mouse.position,this.drawApp.mouse.lastPosition,t=>this._pencilTool(t)):(this._dragging=!0,this._pencilTool(ot(this.drawApp.mouse.position,this.drawApp))):(this._pixelPoints.positions.length>0&&(this._pixelPoints=$t.FlushDuplicatedData(this._pixelPoints,this.drawApp.settings.gridSize),this.drawApp.data.writeData(this._pixelPoints),this._pixelPoints={positions:[],colors:[],type:N.Array}),this._dragging=!1))}_pencilTool(t){var s,r;this.rainbowColor++,this.rainbowColor>this.drawApp.settings.numColors-1&&(this.rainbowColor=0);let a;this.rainbow?a=mt(xt({H:this.rainbowColor*360/this.drawApp.settings.numColors,S:100,V:100})):a=this.drawApp.toolSelector.colorSelected,this.drawApp.ctx.fillStyle=a,a=this.drawApp.ctx.fillStyle,this.size===1?(this.drawApp.paintCanvas(st(t,this.drawApp),this.drawApp.settings.showGrid,a),(s=this._pixelPoints.positions)===null||s===void 0||s.push(t),(r=this._pixelPoints.colors)===null||r===void 0||r.push(a)):[{x:t.x-1,y:t.y},{x:t.x+1,y:t.y},{x:t.x,y:t.y-1},{x:t.x,y:t.y+1},{x:t.x,y:t.y}].forEach(u=>{var w,v;(w=this._pixelPoints.positions)===null||w===void 0||w.push(u),(v=this._pixelPoints.colors)===null||v===void 0||v.push(a),this.drawApp.paintCanvas(st(u,this.drawApp),this.drawApp.settings.showGrid,a)}),this.drawApp.gui.reloadRelativeGUI()}}class ki extends et{onAction(){var t;if(super.onAction(),!!this.canRun)if(this.drawApp.mouse.button===d.NONE){if(this._dragging){this._dragging=!1,this.drawApp.ctx.fillStyle=this.drawApp.toolSelector.colorSelected;const s={positions:[],color:this.drawApp.ctx.fillStyle,type:N.Array},r=this.drawApp.mouse.dataPosition;(t=s.positions)===null||t===void 0||t.push(r),lt(r,this.drawApp,s.positions,this.drawApp.data.pixels[r.x][r.y]),this.drawApp.data.writeData(s),this.drawApp.reloadCanvas()}}else this.drawApp.mouse.button===d.LEFT&&(this._dragging?this._dragging:this._dragging=!0)}}class Fi extends et{onAction(){if(super.onAction(),!!this.canRun)if(this.drawApp.mouse.button===d.NONE){if(this._dragging){this._dragging=!1,this.drawApp.toolSelector.colorSelected="#"+this.drawApp.data.pixels[this.drawApp.mouse.dataPosition.x][this.drawApp.mouse.dataPosition.y];const t=this.drawApp.toolSelector.tools.find(s=>s.toolType===g.PENCIL);t.rainbow=!1}}else this.drawApp.mouse.button===d.LEFT&&(this._dragging?this._dragging:this._dragging=!0)}}class Hi extends et{onAction(){if(super.onAction(),!!this.canRun){if(this.drawApp.mouse.button===d.NONE){this._dragging=!1,this.drawApp.toolSelector.restoreTool();return}if(!this._dragging)this._dragging=!0,this.firstPoint=this.drawApp.mouse.realPosition;else if(this._dragging&&this.drawApp.zoom.level!==this.drawApp.zoom.minLevel){const t={x:this.drawApp.zoom.offset.x-(this.firstPoint.x-this.drawApp.mouse.realPosition.x),y:this.drawApp.zoom.offset.y-(this.firstPoint.y-this.drawApp.mouse.realPosition.y)};t.x<=0&&this.drawApp.canvas.width<t.x+this.drawApp.canvas.width*this.drawApp.zoom.level&&(this.drawApp.zoom.offset.x=t.x),t.y<=0&&this.drawApp.canvas.height<t.y+this.drawApp.canvas.height*this.drawApp.zoom.level&&(this.drawApp.zoom.offset.y=t.y),this.firstPoint=this.drawApp.mouse.realPosition,this.drawApp.reloadCanvas()}}}}class Gi extends et{constructor(t,s,r){super(t,s),this.level=r.level,this.maxLevel=r.maxLevel,this.minLevel=r.minLevel,this.offset={x:0,y:0},this.position={x:0,y:0},this.stepsMouseWheel=r.stepsMouseWheel}zoomIn(){this._zoomScaled(this.drawApp.mouse.scrollStep)}zoomOut(){this._zoomScaled(-this.drawApp.mouse.scrollStep)}_zoomScaled(t){const s={x:this.drawApp.mouse.relativeRealPosition.x/this.drawApp.canvas.width,y:this.drawApp.mouse.relativeRealPosition.y/this.drawApp.canvas.height};this.level=C(Math.round((this.level+t)*10)/10,this.minLevel,this.maxLevel),this.offset={x:-C(this.drawApp.canvas.width*this.level*s.x-this.drawApp.mouse.realPosition.x,0,this.drawApp.canvas.width*this.level-this.drawApp.canvas.width),y:-C(this.drawApp.canvas.height*this.level*s.y-this.drawApp.mouse.realPosition.y,0,this.drawApp.canvas.height*this.level-this.drawApp.canvas.height)},this.drawApp.reloadCanvas()}onAction(){super.onAction(),this.canRun&&this.drawApp.mouse.button===d.NONE&&(this.drawApp.mouse.scroll===G.UP?this.zoomIn():this.drawApp.mouse.scroll===G.DOWN&&this.drawApp.zoom.level!==this.drawApp.zoom.minLevel&&this.zoomOut())}}class Bi extends et{constructor(t,s){super(t,s),this._circlePixels=[],this.fill=!1}onAction(){var t;super.onAction(),this.canRun&&(this.drawApp.mouse.button===d.NONE?this._dragging&&(this._circlePixels.length>1&&(this.drawApp.ctx.fillStyle=this.drawApp.toolSelector.colorSelected,this.drawApp.data.writeData({positions:this._circlePixels,color:this.drawApp.ctx.fillStyle,type:N.Array})),this.drawApp.reloadCanvas(),this._dragging=!1):this.drawApp.mouse.button===d.LEFT&&(this._dragging?this._dragging&&(this.drawApp.mouse.position.x!==((t=this.drawApp.mouse.lastPosition)===null||t===void 0?void 0:t.x)||this.drawApp.mouse.position.y!==this.drawApp.mouse.lastPosition.y)&&(this.drawApp.reloadCanvas(),this._circle()):(this.centerCircle=this.drawApp.mouse.dataPosition,this._draw(this.centerCircle),this._dragging=!0)))}_circle(){if(!this._dragging)return;const t=Math.max(Math.abs(this.centerCircle.x-this.drawApp.mouse.dataPosition.x),Math.abs(this.centerCircle.y-this.drawApp.mouse.dataPosition.y));if(t<1)this._draw(this.centerCircle);else{let s=(5-t*4)/4,r=t;this._circlePixels=[];for(let a=0;a<=r;a++)y({x:this.centerCircle.x+a,y:this.centerCircle.y+r},this._circlePixels),y({x:this.centerCircle.x+a,y:this.centerCircle.y-r},this._circlePixels),y({x:this.centerCircle.x-a,y:this.centerCircle.y+r},this._circlePixels),y({x:this.centerCircle.x-a,y:this.centerCircle.y-r},this._circlePixels),y({x:this.centerCircle.x+r,y:this.centerCircle.y+a},this._circlePixels),y({x:this.centerCircle.x+r,y:this.centerCircle.y-a},this._circlePixels),y({x:this.centerCircle.x-r,y:this.centerCircle.y+a},this._circlePixels),y({x:this.centerCircle.x-r,y:this.centerCircle.y-a},this._circlePixels),s<0?s+=2*a+1:(s+=2*(a-r)+1,r--);this.fill&&(y(this.centerCircle,this._circlePixels),at(this.centerCircle,this.drawApp,this._circlePixels)),this._circlePixels.forEach(a=>this._draw(a))}}_draw(t){this.drawApp.paintCanvas(st(t,this.drawApp),this.drawApp.settings.showGrid),this.drawApp.gui.reloadRelativeGUI()}}var g;(function(n){n[n.NONE=-1]="NONE",n[n.PENCIL=0]="PENCIL",n[n.BUCKET=1]="BUCKET",n[n.COLOUR_PICKER=2]="COLOUR_PICKER",n[n.MOVE=3]="MOVE",n[n.ZOOM=4]="ZOOM",n[n.CIRCLE=5]="CIRCLE",n[n.GRID=6]="GRID",n[n.CLEAR=7]="CLEAR"})(g||(g={}));class Vi{constructor(t){this.startTool=g.PENCIL,this.selected=-1,this.previousSelected=-1,this.colorSelected="000000",this.tools=[],this.tools.push(new ti(t,g.PENCIL)),this.tools.push(new ki(t,g.BUCKET)),this.tools.push(new Fi(t,g.COLOUR_PICKER)),this.tools.push(new Hi(t,g.MOVE)),this.tools.push(new Gi(t,g.ZOOM,{level:1,minLevel:1,maxLevel:8,stepsMouseWheel:.1})),this.tools.push(new Bi(t,g.CIRCLE))}get tool(){return this.selected>=0?this.tools[this.selected]:void 0}set selectTool(t){this.selected!==t.valueOf()&&(this.previousSelected=this.selected,this.selected=t.valueOf())}restoreTool(){this.previousSelected!==-1&&(this.selected=this.previousSelected,this.previousSelected=-1)}}var d;(function(n){n[n.NONE=-1]="NONE",n[n.LEFT=0]="LEFT",n[n.MIDDLE=1]="MIDDLE",n[n.RIGHT=2]="RIGHT"})(d||(d={}));var G;(function(n){n[n.NONE=-1]="NONE",n[n.UP=0]="UP",n[n.DOWN=1]="DOWN"})(G||(G={}));class Wi{constructor(t){this._drawApp=t,this.button=d.NONE,this.scroll=G.NONE,this.moving=!1,this.realPosition={x:0,y:0},this.lastPosition=void 0,this.scrollStep=.1}get position(){return st(this.dataPosition,this._drawApp)}get relativeRealPosition(){const t={x:this.realPosition.x,y:this.realPosition.y};return t.x-=this._drawApp.zoom.offset.x,t.x/=this._drawApp.zoom.level,t.y-=this._drawApp.zoom.offset.y,t.y/=this._drawApp.zoom.level,t}get dataPosition(){return ot(this.relativeRealPosition,this._drawApp)}mouseDownLeft(){this.button=d.LEFT}mouseDownRight(){this.button=d.RIGHT,this._drawApp.gui.toolbox.toggle()}mouseUpLeft(){this.button=d.NONE}mouseUpRight(){this.button=d.NONE}mouseWheelButtonDown(){this.button=d.MIDDLE,this._drawApp.toolSelector.selectTool=g.MOVE}mouseWheelButtonUp(){this.button=d.NONE}mouseWheelDown(){this.button===d.NONE&&(this.scroll=G.DOWN,this._drawApp.toolSelector.selectTool=g.ZOOM)}mouseWheelUp(){this.button===d.NONE&&(this.scroll=G.UP,this._drawApp.toolSelector.selectTool=g.ZOOM)}mouseMove(t){this.realPosition=t}mouseLeave(){this.button=d.NONE}}class Yi{constructor(t){this._drawApp=t,window.addEventListener("resize",()=>this.onResizeWindow(this._drawApp)),this._drawApp.canvas.addEventListener("mousedown",s=>this.onMouseDown(s)),this._drawApp.canvas.addEventListener("mouseup",s=>this.onMouseUp(s)),this._drawApp.canvas.addEventListener("wheel",s=>this.onMouseWheel(s)),this._drawApp.canvas.addEventListener("mousemove",s=>this.onMouseMove(s)),this._drawApp.canvas.addEventListener("mouseenter",s=>this.onMouseEnter(s)),this._drawApp.canvas.addEventListener("contextmenu",s=>this.onContextMenu(s)),this._drawApp.canvas.addEventListener("touchstart",s=>s.cancelable?s.preventDefault():null),this._drawApp.canvas.addEventListener("touchmove",s=>s.cancelable?s.preventDefault():null),this._drawApp.canvas.addEventListener("touchend",s=>this.onTouchEnd(s)),this._drawApp.touch.mc.on("press",s=>this.onTouchPress(s)),this._drawApp.touch.mc.on("move",s=>this.onTouchMove(s)),this._drawApp.touch.mc.on("twofingerstap",s=>this.onTwoFingersTap(s)),this._drawApp.touch.mc.on("twofingerspanmove twofingerspinchmove",s=>this.onTwoFingersMove(s))}onTouchEnd(t){t.cancelable&&t.preventDefault(),this._drawApp.touch.touchEnd(s=>this.onButtonUp({button:this._drawApp.mouse.button,position:s}))}onTouchPress(t){this._drawApp.touch.touchPress(t,s=>this.onButtonDown({button:d.LEFT,position:s}))}onTouchMove(t){this._drawApp.touch.touchMove(t,s=>this.onMove({button:d.LEFT,position:s}))}onTwoFingersMove(t){this._drawApp.touch.touchTwoFingers(t,s=>this.onButtonDown({button:d.MIDDLE,position:s}),(s,r)=>this.onZoom({button:d.MIDDLE,position:s,scroll:r?-1:1}))}onTwoFingersTap(t){this._drawApp.touch.touchTwoFingersTap(t,()=>this.onButtonDown({button:d.RIGHT,position:Dt}))}onMouseDown(t){t.preventDefault(),this.onButtonDown({button:t.button,position:{x:t.offsetX,y:t.offsetY}})}onButtonDown(t){const s=this._drawApp.mouse;this._setupMousePosition(t.position),t.button===d.LEFT?s.mouseDownLeft():t.button===d.RIGHT?s.mouseDownRight():t.button===d.MIDDLE&&s.mouseWheelButtonDown(),s.button!==d.NONE&&this._dispatchEvent()}onMouseUp(t){t.preventDefault(),this.onButtonUp({button:t.button,position:{x:t.offsetX,y:t.offsetY}})}onButtonUp(t){const s=this._drawApp.mouse;this._setupMousePosition(t.position),t.button===d.LEFT?s.mouseUpLeft():t.button===d.RIGHT?(s.mouseUpRight(),this._drawApp.toolSelector.tool!==void 0&&this._drawApp.canvas.dispatchEvent(this._drawApp.toolSelector.tool.event)):t.button===d.MIDDLE&&s.mouseWheelButtonUp(),this._dispatchEvent()}onMouseWheel(t){t.preventDefault(),this._drawApp.mouse.scrollStep=this._drawApp.zoom.stepsMouseWheel,this.onZoom({scroll:t.deltaY,position:{x:t.offsetX,y:t.offsetY}})}onZoom(t){const s=this._drawApp.mouse;this._setupMousePosition(t.position),t.scroll>0?s.mouseWheelDown():t.scroll<0&&s.mouseWheelUp(),s.scroll!==G.NONE&&(this._dispatchEvent(),s.scroll=G.NONE,this._drawApp.toolSelector.restoreTool())}onMouseMove(t){t.preventDefault(),this.onMove({button:t.button,position:{x:t.offsetX,y:t.offsetY}})}onMove(t){const s=this._drawApp.mouse;s.moving=!0,this._setupMousePosition(t.position),s.button!==d.NONE?this._dispatchEvent():this._drawApp.gui.mouseCheck(),s.moving=!1}onMouseEnter(t){const s=this._drawApp.mouse;t.buttons===d.LEFT&&(s.mouseLeave(),this._dispatchEvent()),s.button!==d.NONE&&this._setupMousePosition({x:t.offsetX,y:t.offsetY})}onContextMenu(t){t.preventDefault()}onResizeWindow(t){t.resizeWindow()}_setupMousePosition(t){const s=this._drawApp.mouse;t===void 0&&(t=Dt),s.lastPosition===null?(s.mouseMove({x:t.x,y:t.y}),s.lastPosition={x:s.position.x,y:s.position.y}):(s.lastPosition={x:s.position.x,y:s.position.y},s.mouseMove({x:t.x,y:t.y}))}_dispatchEvent(){this._drawApp.toolSelector.tool!==void 0&&(this._drawApp.gui.mouseCheck(),this._drawApp.canvas.dispatchEvent(this._drawApp.toolSelector.tool.event))}}class x{constructor(t,s){this.drawApp=t,this.name=s,this.enabled=!1,this.clickIn=!0,this.child=[],this.active=!1,this.loaded=!1,this.selectable=!0,this.hoverable=!0}set size(t){this._size=t}get size(){return this._size}set position(t){this._position=t}get position(){return this._position}hide(){this.enabled=!1}show(){this.enabled=!0}hover(){this.drawApp.ctx.filter="hue-rotate(180deg)",this.ui(),this.drawApp.ctx.filter="none"}static AddElement(t,s,r,a,c,u){c!==void 0?r._position=c:r._position={x:0,y:0},a!==null?(u!==void 0?(a.width=u.x,a.height=u.y):(a.width=68,a.height=68),r.size={x:a.width,y:a.height},r.img=a):r.size=u,t.push(r)}setActive(t=this.img,s=270){this.img!==void 0&&(this.active=!0,this.drawApp.ctx.filter=`hue-rotate(${s}deg)`,this.drawApp.ctx.drawImage(t,this._position.x,this._position.y,this.size.x,this.size.y),this.drawApp.ctx.filter="none")}}class Xi extends x{windowResize(){this.position={x:this.parent.position.x+this.parent.size.x-this.size.x,y:this.parent.position.y+this.parent.size.y-this.size.y}}mouseUp(){const t={x:C(this.drawApp.mouse.realPosition.x,0,this.position.x+this.size.x-1),y:C(this.drawApp.mouse.realPosition.y,0,this.position.y+this.size.y-1)};this.drawApp.toolSelector.colorSelected=Ui(this.drawApp.ctx.getImageData(t.x,t.y,1,1).data);const s=this.drawApp.toolSelector.tools[g.PENCIL];s.rainbow=!1}ui(){const t=this.parent;if(t.change){t.change=!1;const s=10;let r=0,a=0;const c={x:this.size.x/11,y:this.size.y/11};for(let u=0;u<=this.size.y;u+=this.pixelSize.y*s){r=0;for(let w=0;w<=this.size.x;w+=this.pixelSize.x*s)this.drawApp.ctx.fillStyle=mt(xt({H:t.hue,S:r,V:100-a})),this.drawApp.ctx.fillRect(Math.fround(this.position.x+r/s*c.x),Math.fround(this.position.y+a/s*c.y),c.x,c.y),r+=s;a+=s}this._imageData=this.drawApp.ctx.getImageData(this.position.x,this.position.y,this.size.x,this.size.y)}else this.drawApp.ctx.putImageData(this._imageData,this.position.x,this.position.y)}}class Zi extends x{_sizeHueSelector(t=1){return this.hueSelectorSize.x/this.drawApp.settings.numColors*t}_hue(t){return Math.trunc(360/this.drawApp.settings.numColors*t)}init(){this.colorPickedSize=50,this.hueSelectorSize={x:this.size.x-this.colorPickedSize,y:this.size.y},this.hueSelectorPosition={x:this.position.x+this.size.x-this.hueSelectorSize.x,y:this.position.y};for(let t=0;t<this.drawApp.settings.numColors;t++)this.drawApp.ctx.fillStyle=mt(xt({H:this._hue(t),S:100,V:100})),this.drawApp.ctx.fillRect(this.hueSelectorPosition.x+this._sizeHueSelector(t),this.hueSelectorPosition.y,this._sizeHueSelector(),this.hueSelectorSize.y);this.parent.hue=this._hue(Ri(0,19)),this.drawApp.toolSelector.colorSelected=mt(xt({H:this.parent.hue,S:100,V:100})),this._imageData=this.drawApp.ctx.getImageData(this.hueSelectorPosition.x,this.hueSelectorPosition.y,this.hueSelectorSize.x,this.hueSelectorSize.y),this.drawApp.reloadCanvas()}windowResize(){this.position={x:this.parent.position.x,y:this.parent.position.y},this.hueSelectorPosition={x:this.position.x+this.size.x-this.hueSelectorSize.x,y:this.position.y}}mouseUp(){const t=this.drawApp.mouse.realPosition;X(t,this.position,{x:this.position.x+this.colorPickedSize,y:this.position.y+this.size.y})||this.changeHue()}changeHue(){const t=this.drawApp.mouse.realPosition,s=this._hue(Math.floor(C(t.x-this.hueSelectorPosition.x,0,this.hueSelectorSize.x)/this._sizeHueSelector())),r=this.parent;r.hue=s,r.change=!0}ui(){this.drawApp.ctx.fillStyle=this.drawApp.toolSelector.colorSelected,this.drawApp.ctx.fillRect(this.position.x,this.position.y,this.colorPickedSize,this.hueSelectorSize.y),this.drawApp.ctx.putImageData(this._imageData,this.hueSelectorPosition.x,this.hueSelectorPosition.y)}}class ii extends x{windowResize(){this.position={x:this.drawApp.canvas.width-this.size.x-5,y:this.drawApp.canvas.height-this.size.y-5},this.child.forEach(t=>{t.windowResize&&t.windowResize()})}init(){const t=new Xi(this.drawApp,"ColorSelectorMain");t.parent=this,t.hoverable=!1,t.selectable=!1,t.size={x:this.size.x,y:200},t.position={x:this.position.x+this.size.x-t.size.x,y:this.position.y+this.size.y-t.size.y},t.pixelSize={x:t.size.x/100,y:t.size.y/100},this.child.push(t);const s=new Zi(this.drawApp,"ColorSelectorSecondary");s.parent=this,s.hoverable=!1,s.selectable=!1,s.size={x:this.size.x,y:this.size.y-t.size.y},s.position={x:this.position.x,y:this.position.y},s.init(),this.child.push(s)}mouseUp(){const t={x:C(this.drawApp.mouse.realPosition.x,0,this.position.x+this.size.x-1),y:C(this.drawApp.mouse.realPosition.y,0,this.position.y+this.size.y-1)};this.child.forEach(s=>{X(t,s.position,{x:s.position.x+s.size.x,y:s.position.y+s.size.y})&&(s.mouseUp(),this.drawApp.reloadCanvas(),this.drawApp.gui.reloadGUI())})}ui(){this.child.forEach(t=>t.ui())}}class qi extends x{constructor(){super(...arguments),this._rainbowSelectorTime=1e3}init(){this._pencilTool=this.drawApp.toolSelector.tools.find(t=>t.toolType===g.PENCIL)}mouseDown(){this._startTime=new Date().getTime()}mouseUp(){this.drawApp.toolSelector.tool instanceof ti?new Date().getTime()-this._startTime>this._rainbowSelectorTime?(this._pencilTool.rainbowColor=this.parent.child.find(t=>t instanceof ii).hue/(360/this.drawApp.settings.numColors)-1,this._pencilTool.rainbow=!this._pencilTool.rainbow):this._pencilTool.size=this._pencilTool.size===1?2:1:this.drawApp.toolSelector.selectTool=g.PENCIL}ui(){let t;this._pencilTool.size===1?t=this.img:t=this.imgAlternative,this.active?this._pencilTool.rainbow?this.setActive(t,120):this.setActive(t):this.drawApp.ctx.drawImage(t,this.position.x,this.position.y,this.size.x,this.size.y)}}class ji extends x{mouseUp(){this.drawApp.toolSelector.selectTool=g.CIRCLE;const t=this.drawApp.toolSelector.tools[g.CIRCLE];this.active&&(t.fill=!t.fill)}ui(){const s=this.drawApp.toolSelector.tools[g.CIRCLE].fill?this.imgFilled:this.img;this.active?this.setActive(s):this.drawApp.ctx.drawImage(s,this.position.x,this.position.y,this.size.x,this.size.y)}}class Ki extends x{mouseUp(){this.drawApp.toggleGrid()}ui(){const t=this.drawApp.settings.showGrid?this.imgFilled:this.img;this.drawApp.ctx.drawImage(t,this.position.x,this.position.y,this.size.x,this.size.y)}}class Ji extends x{windowResize(){this.position={x:this.drawApp.canvas.width-this.size.x,y:0}}ui(){this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y)}mouseUp(){this.drawApp.data.clearData(),this.drawApp.reloadCanvas(),this.drawApp.gui.reloadGUI()}}class Qi extends x{mouseUp(){this.drawApp.toolSelector.selectTool=g.BUCKET}ui(){this.active?this.setActive():this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y)}}class $i extends x{mouseUp(){this.drawApp.toolSelector.selectTool=g.COLOUR_PICKER}ui(){this.active?this.setActive():this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y)}}class te extends x{mouseUp(){this.drawApp.data.undo(),this.drawApp.reloadCanvas(),this.drawApp.gui.reloadGUI()}hover(){this.drawApp.data.canUndo()&&super.hover()}ui(){this.drawApp.data.canUndo()?this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y):(this.drawApp.ctx.filter="grayscale(100%) hue-rotate(180deg)",this.drawApp.ctx.globalAlpha=.5,this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y),this.drawApp.ctx.globalAlpha=1,this.drawApp.ctx.filter="none")}}class ie extends x{mouseUp(){this.drawApp.data.redo(),this.drawApp.reloadCanvas(),this.drawApp.gui.reloadGUI()}hover(){this.drawApp.data.canRedo()&&super.hover()}ui(){this.drawApp.data.canRedo()?this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y):(this.drawApp.ctx.filter="grayscale(100%) hue-rotate(180deg)",this.drawApp.ctx.globalAlpha=.5,this.drawApp.ctx.drawImage(this.img,this.position.x,this.position.y,this.size.x,this.size.y),this.drawApp.ctx.globalAlpha=1,this.drawApp.ctx.filter="none")}}const ee='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M19 9l-2 9a2 2.5 0 0 1 -2 2h-6a2 2.5 0 0 1 -2 -2l-2 -9Z" /><path d="M7 9a5 5 0 0 1 10 0" /></svg>',se='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9" /></svg>',oe='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9" fill="#03A9F4" /></svg>',ne='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /></svg>',re='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="11" y1="7" x2="17" y2="13" /><path d="M5 19v-4l9.7 -9.7a1 1 0 0 1 1.4 0l2.6 2.6a1 1 0 0 1 0 1.4l-9.7 9.7h-4" /></svg>',he='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="4" y="4" width="6" height="6" rx="1" /><rect x="14" y="4" width="6" height="6" rx="1" /><rect x="4" y="14" width="6" height="6" rx="1" /><rect x="14" y="14" width="6" height="6" rx="1" /></svg>',ae='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="4" y="4" width="16" height="16" rx="2" /></svg>',le='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 21v-4a4 4 0 1 1 4 4h-4" /><path d="M21 3a16 16 0 0 0 -12.8 10.2" /><path d="M21 3a16 16 0 0 1 -10.2 12.8" /><path d="M10.6 9a9 9 0 0 1 4.4 4.4" /></svg>',ce='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 21v-4a4 4 0 1 1 4 4h-4" fill="#03A9F4"/><path d="M21 3a16 16 0 0 0 -12.8 10.2" /><path d="M21 3a16 16 0 0 1 -10.2 12.8" /><path d="M10.6 9a9 9 0 0 1 4.4 4.4" /></svg>',pe='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M15 13l4 -4l-4 -4m4 4h-11a4 4 0 0 0 0 8h1" /></svg>',ue='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" stroke-width="1.5" stroke="#03A9F4" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9 13l-4 -4l4 -4m-4 4h11a4 4 0 0 1 0 8h-1" /></svg>';var de=globalThis&&globalThis.__awaiter||function(n,t,s,r){function a(c){return c instanceof s?c:new s(function(u){u(c)})}return new(s||(s=Promise))(function(c,u){function w(S){try{T(r.next(S))}catch(J){u(J)}}function v(S){try{T(r.throw(S))}catch(J){u(J)}}function T(S){S.done?c(S.value):a(S.value).then(w,v)}T((r=r.apply(n,t||[])).next())})};class fe extends x{windowResize(){this.size={x:this.drawApp.canvas.width,y:this.drawApp.canvas.height},this.child.forEach(t=>{t.windowResize&&t.windowResize()})}init(t){this.drawApp.setSizeCanvas(),this.size={x:this.drawApp.canvas.width,y:this.drawApp.canvas.height},this.position={x:0,y:0},this.loadImagesAndButtons().then(()=>{t.push(this),setTimeout(()=>{this.loaded=!0},100)})}loadImagesAndButtons(){return de(this,void 0,void 0,function*(){const s=new qi(this.drawApp,g.PENCIL.toString());s.parent=this,s.init(),x.AddElement(this.child,this.drawApp,s,L(le),{x:this.position.x,y:this.position.y}),s.imgAlternative=L(ce);const r=new ji(this.drawApp,g.CIRCLE.toString());x.AddElement(this.child,this.drawApp,r,L(se),{x:this.position.x,y:this.position.y+64*this.child.length}),r.imgFilled=L(oe),x.AddElement(this.child,this.drawApp,new Qi(this.drawApp,g.BUCKET.toString()),L(ee),{x:this.position.x,y:this.position.y+64*this.child.length}),x.AddElement(this.child,this.drawApp,new $i(this.drawApp,g.COLOUR_PICKER.toString()),L(re),{x:this.position.x,y:this.position.y+64*this.child.length});const a=new Ki(this.drawApp,g.GRID.toString());a.selectable=!1,x.AddElement(this.child,this.drawApp,a,L(he),{x:this.position.x,y:this.position.y+64*this.child.length}),a.imgFilled=L(ae);const c=new Ji(this.drawApp,g.CLEAR.toString());c.selectable=!1,x.AddElement(this.child,this.drawApp,c,L(ne),{x:this.drawApp.canvas.width-64,y:0});const u=new te(this.drawApp,"undoButton");u.selectable=!1,x.AddElement(this.child,this.drawApp,u,L(ue),{x:this.position.x+64,y:this.position.y});const w=new ie(this.drawApp,"redoButton");w.selectable=!1,x.AddElement(this.child,this.drawApp,w,L(pe),{x:this.position.x+64*2,y:this.position.y});const v=new ii(this.drawApp,"Color Selector");v.selectable=!1,v.change=!0,v.hoverable=!1,v.size={x:280,y:250},v.position={x:this.drawApp.canvas.width-v.size.x-5,y:this.drawApp.canvas.height-v.size.y-5},v.init(),this.child.push(v),this.drawApp.toolSelector.selectTool=this.drawApp.toolSelector.startTool,this.child.find(T=>{var S;return T.name===((S=this.drawApp.toolSelector.tool)===null||S===void 0?void 0:S.name)}).active=!0})}toggle(){this.loaded&&(this.enabled?this.hide():this.show())}show(){this.enabled=!0,this.child.forEach(t=>t.show()),this.ui()}hide(){this.enabled=!1,this.drawApp.gui.reloadGUI(),this.drawApp.reloadCanvas()}ui(){this.drawApp.ctx.fillStyle="gray",this.drawApp.ctx.globalAlpha=.6,this.drawApp.ctx.fillRect(this.position.x,this.position.y,this.size.x,this.size.y),this.drawApp.ctx.globalAlpha=1,this.child.forEach(t=>t.ui())}mouseUp(){this.child.forEach(t=>{if(K.CheckInsideGUIElement(this.drawApp,t)){if(!t.selectable){t.mouseUp&&t.mouseUp();return}this.child.filter(s=>s.name!==t.name).forEach(s=>{s.active=!1,s.ui()}),t.mouseUp(),t.setActive(),t.ui(),this.drawApp.reloadCanvas(),this.drawApp.gui.reloadGUI()}})}mouseDown(){this.child.forEach(t=>{K.CheckInsideGUIElement(this.drawApp,t)&&t.mouseDown&&t.mouseDown()})}}function ve(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ei={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(n){(function(t,s,r,a){var c=["","webkit","Moz","MS","ms","o"],u=s.createElement("div"),w="function",v=Math.round,T=Math.abs,S=Date.now;function J(i,e,o){return setTimeout(Rt(i,o),e)}function nt(i,e,o){return Array.isArray(i)?(B(i,o[e],o),!0):!1}function B(i,e,o){var h;if(i)if(i.forEach)i.forEach(e,o);else if(i.length!==a)for(h=0;h<i.length;)e.call(o,i[h],h,i),h++;else for(h in i)i.hasOwnProperty(h)&&e.call(o,i[h],h,i)}function si(i,e,o){var h="DEPRECATED METHOD: "+e+`
`+o+` AT 
`;return function(){var l=new Error("get-stack-trace"),p=l&&l.stack?l.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=t.console&&(t.console.warn||t.console.log);return f&&f.call(t.console,h,p),i.apply(this,arguments)}}var R;typeof Object.assign!="function"?R=function(e){if(e===a||e===null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),h=1;h<arguments.length;h++){var l=arguments[h];if(l!==a&&l!==null)for(var p in l)l.hasOwnProperty(p)&&(o[p]=l[p])}return o}:R=Object.assign;var oi=si(function(e,o,h){for(var l=Object.keys(o),p=0;p<l.length;)(!h||h&&e[l[p]]===a)&&(e[l[p]]=o[l[p]]),p++;return e},"extend","Use `assign`."),ye=si(function(e,o){return oi(e,o,!0)},"merge","Use `assign`.");function O(i,e,o){var h=e.prototype,l;l=i.prototype=Object.create(h),l.constructor=i,l._super=h,o&&R(l,o)}function Rt(i,e){return function(){return i.apply(e,arguments)}}function Ut(i,e){return typeof i==w?i.apply(e&&e[0]||a,e):i}function ni(i,e){return i===a?e:i}function At(i,e,o){B(_t(e),function(h){i.addEventListener(h,o,!1)})}function yt(i,e,o){B(_t(e),function(h){i.removeEventListener(h,o,!1)})}function ri(i,e){for(;i;){if(i==e)return!0;i=i.parentNode}return!1}function Q(i,e){return i.indexOf(e)>-1}function _t(i){return i.trim().split(/\s+/g)}function rt(i,e,o){if(i.indexOf&&!o)return i.indexOf(e);for(var h=0;h<i.length;){if(o&&i[h][o]==e||!o&&i[h]===e)return h;h++}return-1}function Et(i){return Array.prototype.slice.call(i,0)}function hi(i,e,o){for(var h=[],l=[],p=0;p<i.length;){var f=e?i[p][e]:i[p];rt(l,f)<0&&h.push(i[p]),l[p]=f,p++}return o&&(e?h=h.sort(function(_,I){return _[e]>I[e]}):h=h.sort()),h}function Tt(i,e){for(var o,h,l=e[0].toUpperCase()+e.slice(1),p=0;p<c.length;){if(o=c[p],h=o?o+l:e,h in i)return h;p++}return a}var _e=1;function Ee(){return _e++}function ai(i){var e=i.ownerDocument||i;return e.defaultView||e.parentWindow||t}var Te=/mobile|tablet|ip(ad|hone|od)|android/i,li="ontouchstart"in t,Se=Tt(t,"PointerEvent")!==a,Pe=li&&Te.test(navigator.userAgent),ct="touch",Ie="pen",kt="mouse",Ce="kinect",ze=25,P=1,$=2,m=4,z=8,St=1,pt=2,ut=4,dt=8,ft=16,U=pt|ut,tt=dt|ft,ci=U|tt,pi=["x","y"],Pt=["clientX","clientY"];function M(i,e){var o=this;this.manager=i,this.callback=e,this.element=i.element,this.target=i.options.inputTarget,this.domHandler=function(h){Ut(i.options.enable,[i])&&o.handler(h)},this.init()}M.prototype={handler:function(){},init:function(){this.evEl&&At(this.element,this.evEl,this.domHandler),this.evTarget&&At(this.target,this.evTarget,this.domHandler),this.evWin&&At(ai(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&yt(this.element,this.evEl,this.domHandler),this.evTarget&&yt(this.target,this.evTarget,this.domHandler),this.evWin&&yt(ai(this.element),this.evWin,this.domHandler)}};function Oe(i){var e,o=i.options.inputClass;return o?e=o:Se?e=Ht:Pe?e=zt:li?e=Gt:e=Ct,new e(i,Ne)}function Ne(i,e,o){var h=o.pointers.length,l=o.changedPointers.length,p=e&P&&h-l===0,f=e&(m|z)&&h-l===0;o.isFirst=!!p,o.isFinal=!!f,p&&(i.session={}),o.eventType=e,Me(i,o),i.emit("hammer.input",o),i.recognize(o),i.session.prevInput=o}function Me(i,e){var o=i.session,h=e.pointers,l=h.length;o.firstInput||(o.firstInput=ui(e)),l>1&&!o.firstMultiple?o.firstMultiple=ui(e):l===1&&(o.firstMultiple=!1);var p=o.firstInput,f=o.firstMultiple,A=f?f.center:p.center,_=e.center=di(h);e.timeStamp=S(),e.deltaTime=e.timeStamp-p.timeStamp,e.angle=Ft(A,_),e.distance=It(A,_),be(o,e),e.offsetDirection=vi(e.deltaX,e.deltaY);var I=fi(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=I.x,e.overallVelocityY=I.y,e.overallVelocity=T(I.x)>T(I.y)?I.x:I.y,e.scale=f?Re(f.pointers,h):1,e.rotation=f?De(f.pointers,h):0,e.maxPointers=o.prevInput?e.pointers.length>o.prevInput.maxPointers?e.pointers.length:o.prevInput.maxPointers:e.pointers.length,Le(o,e);var F=i.element;ri(e.srcEvent.target,F)&&(F=e.srcEvent.target),e.target=F}function be(i,e){var o=e.center,h=i.offsetDelta||{},l=i.prevDelta||{},p=i.prevInput||{};(e.eventType===P||p.eventType===m)&&(l=i.prevDelta={x:p.deltaX||0,y:p.deltaY||0},h=i.offsetDelta={x:o.x,y:o.y}),e.deltaX=l.x+(o.x-h.x),e.deltaY=l.y+(o.y-h.y)}function Le(i,e){var o=i.lastInterval||e,h=e.timeStamp-o.timeStamp,l,p,f,A;if(e.eventType!=z&&(h>ze||o.velocity===a)){var _=e.deltaX-o.deltaX,I=e.deltaY-o.deltaY,F=fi(h,_,I);p=F.x,f=F.y,l=T(F.x)>T(F.y)?F.x:F.y,A=vi(_,I),i.lastInterval=e}else l=o.velocity,p=o.velocityX,f=o.velocityY,A=o.direction;e.velocity=l,e.velocityX=p,e.velocityY=f,e.direction=A}function ui(i){for(var e=[],o=0;o<i.pointers.length;)e[o]={clientX:v(i.pointers[o].clientX),clientY:v(i.pointers[o].clientY)},o++;return{timeStamp:S(),pointers:e,center:di(e),deltaX:i.deltaX,deltaY:i.deltaY}}function di(i){var e=i.length;if(e===1)return{x:v(i[0].clientX),y:v(i[0].clientY)};for(var o=0,h=0,l=0;l<e;)o+=i[l].clientX,h+=i[l].clientY,l++;return{x:v(o/e),y:v(h/e)}}function fi(i,e,o){return{x:e/i||0,y:o/i||0}}function vi(i,e){return i===e?St:T(i)>=T(e)?i<0?pt:ut:e<0?dt:ft}function It(i,e,o){o||(o=pi);var h=e[o[0]]-i[o[0]],l=e[o[1]]-i[o[1]];return Math.sqrt(h*h+l*l)}function Ft(i,e,o){o||(o=pi);var h=e[o[0]]-i[o[0]],l=e[o[1]]-i[o[1]];return Math.atan2(l,h)*180/Math.PI}function De(i,e){return Ft(e[1],e[0],Pt)+Ft(i[1],i[0],Pt)}function Re(i,e){return It(e[0],e[1],Pt)/It(i[0],i[1],Pt)}var Ue={mousedown:P,mousemove:$,mouseup:m},ke="mousedown",Fe="mousemove mouseup";function Ct(){this.evEl=ke,this.evWin=Fe,this.pressed=!1,M.apply(this,arguments)}O(Ct,M,{handler:function(e){var o=Ue[e.type];o&P&&e.button===0&&(this.pressed=!0),o&$&&e.which!==1&&(o=m),this.pressed&&(o&m&&(this.pressed=!1),this.callback(this.manager,o,{pointers:[e],changedPointers:[e],pointerType:kt,srcEvent:e}))}});var He={pointerdown:P,pointermove:$,pointerup:m,pointercancel:z,pointerout:z},Ge={2:ct,3:Ie,4:kt,5:Ce},gi="pointerdown",wi="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(gi="MSPointerDown",wi="MSPointerMove MSPointerUp MSPointerCancel");function Ht(){this.evEl=gi,this.evWin=wi,M.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}O(Ht,M,{handler:function(e){var o=this.store,h=!1,l=e.type.toLowerCase().replace("ms",""),p=He[l],f=Ge[e.pointerType]||e.pointerType,A=f==ct,_=rt(o,e.pointerId,"pointerId");p&P&&(e.button===0||A)?_<0&&(o.push(e),_=o.length-1):p&(m|z)&&(h=!0),!(_<0)&&(o[_]=e,this.callback(this.manager,p,{pointers:o,changedPointers:[e],pointerType:f,srcEvent:e}),h&&o.splice(_,1))}});var Be={touchstart:P,touchmove:$,touchend:m,touchcancel:z},Ve="touchstart",We="touchstart touchmove touchend touchcancel";function xi(){this.evTarget=Ve,this.evWin=We,this.started=!1,M.apply(this,arguments)}O(xi,M,{handler:function(e){var o=Be[e.type];if(o===P&&(this.started=!0),!!this.started){var h=Ye.call(this,e,o);o&(m|z)&&h[0].length-h[1].length===0&&(this.started=!1),this.callback(this.manager,o,{pointers:h[0],changedPointers:h[1],pointerType:ct,srcEvent:e})}}});function Ye(i,e){var o=Et(i.touches),h=Et(i.changedTouches);return e&(m|z)&&(o=hi(o.concat(h),"identifier",!0)),[o,h]}var Xe={touchstart:P,touchmove:$,touchend:m,touchcancel:z},Ze="touchstart touchmove touchend touchcancel";function zt(){this.evTarget=Ze,this.targetIds={},M.apply(this,arguments)}O(zt,M,{handler:function(e){var o=Xe[e.type],h=qe.call(this,e,o);h&&this.callback(this.manager,o,{pointers:h[0],changedPointers:h[1],pointerType:ct,srcEvent:e})}});function qe(i,e){var o=Et(i.touches),h=this.targetIds;if(e&(P|$)&&o.length===1)return h[o[0].identifier]=!0,[o,o];var l,p,f=Et(i.changedTouches),A=[],_=this.target;if(p=o.filter(function(I){return ri(I.target,_)}),e===P)for(l=0;l<p.length;)h[p[l].identifier]=!0,l++;for(l=0;l<f.length;)h[f[l].identifier]&&A.push(f[l]),e&(m|z)&&delete h[f[l].identifier],l++;if(A.length)return[hi(p.concat(A),"identifier",!0),A]}var je=2500,mi=25;function Gt(){M.apply(this,arguments);var i=Rt(this.handler,this);this.touch=new zt(this.manager,i),this.mouse=new Ct(this.manager,i),this.primaryTouch=null,this.lastTouches=[]}O(Gt,M,{handler:function(e,o,h){var l=h.pointerType==ct,p=h.pointerType==kt;if(!(p&&h.sourceCapabilities&&h.sourceCapabilities.firesTouchEvents)){if(l)Ke.call(this,o,h);else if(p&&Je.call(this,h))return;this.callback(e,o,h)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ke(i,e){i&P?(this.primaryTouch=e.changedPointers[0].identifier,Ai.call(this,e)):i&(m|z)&&Ai.call(this,e)}function Ai(i){var e=i.changedPointers[0];if(e.identifier===this.primaryTouch){var o={x:e.clientX,y:e.clientY};this.lastTouches.push(o);var h=this.lastTouches,l=function(){var p=h.indexOf(o);p>-1&&h.splice(p,1)};setTimeout(l,je)}}function Je(i){for(var e=i.srcEvent.clientX,o=i.srcEvent.clientY,h=0;h<this.lastTouches.length;h++){var l=this.lastTouches[h],p=Math.abs(e-l.x),f=Math.abs(o-l.y);if(p<=mi&&f<=mi)return!0}return!1}var yi=Tt(u.style,"touchAction"),_i=yi!==a,Ei="compute",Ti="auto",Bt="manipulation",it="none",vt="pan-x",gt="pan-y",Ot=$e();function Vt(i,e){this.manager=i,this.set(e)}Vt.prototype={set:function(i){i==Ei&&(i=this.compute()),_i&&this.manager.element.style&&Ot[i]&&(this.manager.element.style[yi]=i),this.actions=i.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var i=[];return B(this.manager.recognizers,function(e){Ut(e.options.enable,[e])&&(i=i.concat(e.getTouchAction()))}),Qe(i.join(" "))},preventDefaults:function(i){var e=i.srcEvent,o=i.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}var h=this.actions,l=Q(h,it)&&!Ot[it],p=Q(h,gt)&&!Ot[gt],f=Q(h,vt)&&!Ot[vt];if(l){var A=i.pointers.length===1,_=i.distance<2,I=i.deltaTime<250;if(A&&_&&I)return}if(!(f&&p)&&(l||p&&o&U||f&&o&tt))return this.preventSrc(e)},preventSrc:function(i){this.manager.session.prevented=!0,i.preventDefault()}};function Qe(i){if(Q(i,it))return it;var e=Q(i,vt),o=Q(i,gt);return e&&o?it:e||o?e?vt:gt:Q(i,Bt)?Bt:Ti}function $e(){if(!_i)return!1;var i={},e=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(o){i[o]=e?t.CSS.supports("touch-action",o):!0}),i}var Nt=1,b=2,ht=4,Z=8,V=Z,wt=16,k=32;function W(i){this.options=R({},this.defaults,i||{}),this.id=Ee(),this.manager=null,this.options.enable=ni(this.options.enable,!0),this.state=Nt,this.simultaneous={},this.requireFail=[]}W.prototype={defaults:{},set:function(i){return R(this.options,i),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(i){if(nt(i,"recognizeWith",this))return this;var e=this.simultaneous;return i=Mt(i,this),e[i.id]||(e[i.id]=i,i.recognizeWith(this)),this},dropRecognizeWith:function(i){return nt(i,"dropRecognizeWith",this)?this:(i=Mt(i,this),delete this.simultaneous[i.id],this)},requireFailure:function(i){if(nt(i,"requireFailure",this))return this;var e=this.requireFail;return i=Mt(i,this),rt(e,i)===-1&&(e.push(i),i.requireFailure(this)),this},dropRequireFailure:function(i){if(nt(i,"dropRequireFailure",this))return this;i=Mt(i,this);var e=rt(this.requireFail,i);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(i){return!!this.simultaneous[i.id]},emit:function(i){var e=this,o=this.state;function h(l){e.manager.emit(l,i)}o<Z&&h(e.options.event+Si(o)),h(e.options.event),i.additionalEvent&&h(i.additionalEvent),o>=Z&&h(e.options.event+Si(o))},tryEmit:function(i){if(this.canEmit())return this.emit(i);this.state=k},canEmit:function(){for(var i=0;i<this.requireFail.length;){if(!(this.requireFail[i].state&(k|Nt)))return!1;i++}return!0},recognize:function(i){var e=R({},i);if(!Ut(this.options.enable,[this,e])){this.reset(),this.state=k;return}this.state&(V|wt|k)&&(this.state=Nt),this.state=this.process(e),this.state&(b|ht|Z|wt)&&this.tryEmit(e)},process:function(i){},getTouchAction:function(){},reset:function(){}};function Si(i){return i&wt?"cancel":i&Z?"end":i&ht?"move":i&b?"start":""}function Pi(i){return i==ft?"down":i==dt?"up":i==pt?"left":i==ut?"right":""}function Mt(i,e){var o=e.manager;return o?o.get(i):i}function D(){W.apply(this,arguments)}O(D,W,{defaults:{pointers:1},attrTest:function(i){var e=this.options.pointers;return e===0||i.pointers.length===e},process:function(i){var e=this.state,o=i.eventType,h=e&(b|ht),l=this.attrTest(i);return h&&(o&z||!l)?e|wt:h||l?o&m?e|Z:e&b?e|ht:b:k}});function bt(){D.apply(this,arguments),this.pX=null,this.pY=null}O(bt,D,{defaults:{event:"pan",threshold:10,pointers:1,direction:ci},getTouchAction:function(){var i=this.options.direction,e=[];return i&U&&e.push(gt),i&tt&&e.push(vt),e},directionTest:function(i){var e=this.options,o=!0,h=i.distance,l=i.direction,p=i.deltaX,f=i.deltaY;return l&e.direction||(e.direction&U?(l=p===0?St:p<0?pt:ut,o=p!=this.pX,h=Math.abs(i.deltaX)):(l=f===0?St:f<0?dt:ft,o=f!=this.pY,h=Math.abs(i.deltaY))),i.direction=l,o&&h>e.threshold&&l&e.direction},attrTest:function(i){return D.prototype.attrTest.call(this,i)&&(this.state&b||!(this.state&b)&&this.directionTest(i))},emit:function(i){this.pX=i.deltaX,this.pY=i.deltaY;var e=Pi(i.direction);e&&(i.additionalEvent=this.options.event+e),this._super.emit.call(this,i)}});function Wt(){D.apply(this,arguments)}O(Wt,D,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(i){return this._super.attrTest.call(this,i)&&(Math.abs(i.scale-1)>this.options.threshold||this.state&b)},emit:function(i){if(i.scale!==1){var e=i.scale<1?"in":"out";i.additionalEvent=this.options.event+e}this._super.emit.call(this,i)}});function Yt(){W.apply(this,arguments),this._timer=null,this._input=null}O(Yt,W,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ti]},process:function(i){var e=this.options,o=i.pointers.length===e.pointers,h=i.distance<e.threshold,l=i.deltaTime>e.time;if(this._input=i,!h||!o||i.eventType&(m|z)&&!l)this.reset();else if(i.eventType&P)this.reset(),this._timer=J(function(){this.state=V,this.tryEmit()},e.time,this);else if(i.eventType&m)return V;return k},reset:function(){clearTimeout(this._timer)},emit:function(i){this.state===V&&(i&&i.eventType&m?this.manager.emit(this.options.event+"up",i):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function Xt(){D.apply(this,arguments)}O(Xt,D,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(i){return this._super.attrTest.call(this,i)&&(Math.abs(i.rotation)>this.options.threshold||this.state&b)}});function Zt(){D.apply(this,arguments)}O(Zt,D,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:U|tt,pointers:1},getTouchAction:function(){return bt.prototype.getTouchAction.call(this)},attrTest:function(i){var e=this.options.direction,o;return e&(U|tt)?o=i.overallVelocity:e&U?o=i.overallVelocityX:e&tt&&(o=i.overallVelocityY),this._super.attrTest.call(this,i)&&e&i.offsetDirection&&i.distance>this.options.threshold&&i.maxPointers==this.options.pointers&&T(o)>this.options.velocity&&i.eventType&m},emit:function(i){var e=Pi(i.offsetDirection);e&&this.manager.emit(this.options.event+e,i),this.manager.emit(this.options.event,i)}});function Lt(){W.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}O(Lt,W,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Bt]},process:function(i){var e=this.options,o=i.pointers.length===e.pointers,h=i.distance<e.threshold,l=i.deltaTime<e.time;if(this.reset(),i.eventType&P&&this.count===0)return this.failTimeout();if(h&&l&&o){if(i.eventType!=m)return this.failTimeout();var p=this.pTime?i.timeStamp-this.pTime<e.interval:!0,f=!this.pCenter||It(this.pCenter,i.center)<e.posThreshold;this.pTime=i.timeStamp,this.pCenter=i.center,!f||!p?this.count=1:this.count+=1,this._input=i;var A=this.count%e.taps;if(A===0)return this.hasRequireFailures()?(this._timer=J(function(){this.state=V,this.tryEmit()},e.interval,this),b):V}return k},failTimeout:function(){return this._timer=J(function(){this.state=k},this.options.interval,this),k},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==V&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Y(i,e){return e=e||{},e.recognizers=ni(e.recognizers,Y.defaults.preset),new qt(i,e)}Y.VERSION="2.0.7",Y.defaults={domEvents:!1,touchAction:Ei,enable:!0,inputTarget:null,inputClass:null,preset:[[Xt,{enable:!1}],[Wt,{enable:!1},["rotate"]],[Zt,{direction:U}],[bt,{direction:U},["swipe"]],[Lt],[Lt,{event:"doubletap",taps:2},["tap"]],[Yt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ts=1,Ii=2;function qt(i,e){this.options=R({},Y.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||i,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=i,this.input=Oe(this),this.touchAction=new Vt(this,this.options.touchAction),Ci(this,!0),B(this.options.recognizers,function(o){var h=this.add(new o[0](o[1]));o[2]&&h.recognizeWith(o[2]),o[3]&&h.requireFailure(o[3])},this)}qt.prototype={set:function(i){return R(this.options,i),i.touchAction&&this.touchAction.update(),i.inputTarget&&(this.input.destroy(),this.input.target=i.inputTarget,this.input.init()),this},stop:function(i){this.session.stopped=i?Ii:ts},recognize:function(i){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(i);var o,h=this.recognizers,l=e.curRecognizer;(!l||l&&l.state&V)&&(l=e.curRecognizer=null);for(var p=0;p<h.length;)o=h[p],e.stopped!==Ii&&(!l||o==l||o.canRecognizeWith(l))?o.recognize(i):o.reset(),!l&&o.state&(b|ht|Z)&&(l=e.curRecognizer=o),p++}},get:function(i){if(i instanceof W)return i;for(var e=this.recognizers,o=0;o<e.length;o++)if(e[o].options.event==i)return e[o];return null},add:function(i){if(nt(i,"add",this))return this;var e=this.get(i.options.event);return e&&this.remove(e),this.recognizers.push(i),i.manager=this,this.touchAction.update(),i},remove:function(i){if(nt(i,"remove",this))return this;if(i=this.get(i),i){var e=this.recognizers,o=rt(e,i);o!==-1&&(e.splice(o,1),this.touchAction.update())}return this},on:function(i,e){if(i!==a&&e!==a){var o=this.handlers;return B(_t(i),function(h){o[h]=o[h]||[],o[h].push(e)}),this}},off:function(i,e){if(i!==a){var o=this.handlers;return B(_t(i),function(h){e?o[h]&&o[h].splice(rt(o[h],e),1):delete o[h]}),this}},emit:function(i,e){this.options.domEvents&&is(i,e);var o=this.handlers[i]&&this.handlers[i].slice();if(!(!o||!o.length)){e.type=i,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var h=0;h<o.length;)o[h](e),h++}},destroy:function(){this.element&&Ci(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ci(i,e){var o=i.element;if(o.style){var h;B(i.options.cssProps,function(l,p){h=Tt(o.style,p),e?(i.oldCssProps[h]=o.style[h],o.style[h]=l):o.style[h]=i.oldCssProps[h]||""}),e||(i.oldCssProps={})}}function is(i,e){var o=s.createEvent("Event");o.initEvent(i,!0,!0),o.gesture=e,e.target.dispatchEvent(o)}R(Y,{INPUT_START:P,INPUT_MOVE:$,INPUT_END:m,INPUT_CANCEL:z,STATE_POSSIBLE:Nt,STATE_BEGAN:b,STATE_CHANGED:ht,STATE_ENDED:Z,STATE_RECOGNIZED:V,STATE_CANCELLED:wt,STATE_FAILED:k,DIRECTION_NONE:St,DIRECTION_LEFT:pt,DIRECTION_RIGHT:ut,DIRECTION_UP:dt,DIRECTION_DOWN:ft,DIRECTION_HORIZONTAL:U,DIRECTION_VERTICAL:tt,DIRECTION_ALL:ci,Manager:qt,Input:M,TouchAction:Vt,TouchInput:zt,MouseInput:Ct,PointerEventInput:Ht,TouchMouseInput:Gt,SingleTouchInput:xi,Recognizer:W,AttrRecognizer:D,Tap:Lt,Pan:bt,Swipe:Zt,Pinch:Wt,Rotate:Xt,Press:Yt,on:At,off:yt,each:B,merge:ye,extend:oi,assign:R,inherit:O,bindFn:Rt,prefixed:Tt});var es=typeof t<"u"?t:typeof self<"u"?self:{};es.Hammer=Y,typeof a=="function"&&a.amd?a(function(){return Y}):n.exports?n.exports=Y:t[r]=Y})(window,document,"Hammer")})(ei);var ge=ei.exports;const j=ve(ge);var E;(function(n){n[n.NONE=0]="NONE",n[n.LEFTBUTTON=1]="LEFTBUTTON",n[n.MOVEZOOM=2]="MOVEZOOM"})(E||(E={}));class we{constructor(t){this._drawApp=t,this.mc=new j.Manager(t.canvas),this.touchAction=E.NONE,this.mc.add(new j.Press({time:25})),this.mc.add(new j.Pan({event:"move",pointers:1})),this.mc.add(new j.Tap({event:"singletap"})),this.mc.add(new j.Tap({event:"twofingerstap",pointers:2})),this.mc.add(new j.Pan({event:"twofingerspan",pointers:2,threshold:5})),this.mc.add(new j.Pinch({event:"twofingerspinch",pointers:2,threshold:5})),this.mc.get("twofingerspinch").recognizeWith("twofingerstap"),this.mc.get("twofingerspan").recognizeWith("twofingerstap")}_touchPosition(t){const s=this._drawApp.canvas.getBoundingClientRect();return{x:t.x-s.left,y:t.y-s.top}}touchEnd(t){this.mc.get("twofingerspan").set({enable:!0}),this.mc.get("twofingerspinch").set({enable:!0}),this.touchAction!==E.NONE&&(t(this._touchLastPosition),this.touchAction=E.NONE,this._drawApp.mouse.button=d.NONE,this._drawApp.mouse.moving=!1)}touchPress(t,s){if(t.pointerType==="touch")try{this._touchLastPosition=this._touchPosition({x:t.pointers[0].x,y:t.pointers[0].y}),s(this._touchLastPosition),this.touchAction=E.LEFTBUTTON}catch{}}touchMove(t,s){if(t.pointerType==="touch"&&this.touchAction===E.LEFTBUTTON&&t.pointers!==null&&t.pointers[0].x!==void 0&&t.pointers[0].y!==void 0){const r=this._touchPosition({x:t.pointers[0].x,y:t.pointers[0].y});jt(ot(r,this._drawApp),ot(this._touchLastPosition,this._drawApp))&&(this._touchLastPosition=r,s(this._touchLastPosition))}}touchTwoFingers(t,s,r){if(t.pointerType==="touch"&&this.touchAction===E.NONE||this.touchAction===E.MOVEZOOM){if(this.touchAction===E.NONE)this._drawApp.mouse.moving=!0,this.touchAction=E.MOVEZOOM,this.limiting=0,this.lastScale=t.scale;else if(this.touchAction===E.MOVEZOOM)if(this.limiting>10){const a=this.lastScale<=t.scale;this._touchLastPosition=this._touchPosition({x:t.center.x,y:t.center.y});const c=Math.abs(this.lastScale-t.scale);c>=.08?(this._drawApp.mouse.scrollStep=a?c:c*2,r(this._touchLastPosition,a)):s(this._touchLastPosition),this.lastScale=t.scale,this.limiting=0}else this.limiting++}}touchTwoFingersTap(t,s){t.pointerType==="touch"&&this.touchAction===E.NONE&&(this.mc.get("twofingerspan").set({enable:!1}),this.mc.get("twofingerspinch").set({enable:!1}),s())}}class K{constructor(t){this._drawApp=t,this._clickIn=!0,this.guiElements=[]}initToolBox(){this.toolbox=new fe(this._drawApp,"toolboxGUI"),this.toolbox.init(this.guiElements)}reloadGUI(){this.guiElements.filter(t=>t.enabled).forEach(t=>{t.enabled&&t.ui()})}reloadRelativeGUI(){this._drawApp.settings.showGrid&&(this._centerLines(),this._gridLines())}_gridLines(){if(this._drawApp.mouse.moving&&(this._drawApp.mouse.button===d.MIDDLE||this._drawApp.touch.touchAction===E.MOVEZOOM)){const t=this._drawApp.ctx;t.beginPath(),t.lineWidth=this._drawApp.zoom.level,t.moveTo(0,0);for(let s=1;s<this._drawApp.settings.gridSize;s++){const r=st({x:s,y:s},this._drawApp),a={x:r.x*this._drawApp.zoom.level+this._drawApp.zoom.offset.x,y:r.y*this._drawApp.zoom.level+this._drawApp.zoom.offset.y};t.moveTo(0,a.y),t.lineTo(this._drawApp.canvas.width,a.y),t.moveTo(a.x,0),t.lineTo(a.x,this._drawApp.canvas.height)}t.stroke()}}_centerLines(t=6){this._drawApp.paintCanvas({x:0,y:this._drawApp.canvas.height/2-t/2},!1,this._drawApp.settings.gridColor,this._drawApp.canvas.width,t),this._drawApp.paintCanvas({x:this._drawApp.canvas.width/2-t/2,y:0},!1,this._drawApp.settings.gridColor,t,this._drawApp.canvas.height)}mouseCheck(){this.guiElements.forEach(t=>{t.enabled&&(!t.clickIn&&!this._drawApp.mouse.moving&&(t.clickIn=!0,K.CheckInsideGUIElement(this._drawApp,t)&&t.mouseUp&&t.mouseUp()),this._drawApp.mouse.button===d.NONE&&(this._drawApp.reloadCanvas(),this.reloadGUI(),t.child.forEach(s=>{s.hoverable&&K.CheckInsideGUIElement(this._drawApp,s)&&s.hover()})))}),this.guiElements.forEach(t=>{var s;if(K.CheckInsideGUIElement(this._drawApp,t)){if(!t.enabled)return;(s=this._drawApp.toolSelector.tool)===null||s===void 0||s.event.stopImmediatePropagation(),t.clickIn&&this._drawApp.mouse.button===d.LEFT&&!this._drawApp.mouse.moving&&(t.clickIn=!1,t.mouseDown&&t.mouseDown())}})}static CheckInsideGUIElement(t,s){return s.enabled&&X(t.mouse.realPosition,s.position,{x:s.position.x+s.size.x,y:s.position.y+s.size.y})}}class xe{constructor(t,s){this.canvas=t,this.mouse=new Wi(this),this.touch=new we(this),this.eventCanvas=new Yi(this),this.data=new $t(this,s.gridSize),this.settings=s,this.settings.numColors=20,this.ctx=t.getContext("2d",{alpha:!1}),this.toolSelector=new Vi(this),this.zoom=this.toolSelector.tools[g.ZOOM],this.setSizeCanvas(),this.gui=new K(this),this.gui.initToolBox(),this.reloadCanvas()}getData(){return this.data.pixels}loadData(t){this.data.pixels=t,this.reloadCanvas()}saveImage(){let t=!1;this.settings.showGrid&&(t=!0,this.toggleGrid());const s=this.canvas.toDataURL(),r=document.createElement("a");r.href=s,r.download="image",r.click(),r.remove(),t&&this.toggleGrid()}paintCanvas(t,s=!1,r=this.toolSelector.colorSelected,a=this.settings.pixelSize,c=this.settings.pixelSize){const u={x:t.x*this.zoom.level+this.zoom.offset.x,y:t.y*this.zoom.level+this.zoom.offset.y},w=a*this.zoom.level,v=c*this.zoom.level;r.includes("hsl")?(this.ctx.fillStyle=r,r=this.ctx.fillStyle.substr(1)):r.includes("#")&&(r=r.substr(1)),this.ctx.fillStyle="#"+r,this.ctx.fillRect(u.x,u.y,w,v),s&&this.mouse.button!==d.MIDDLE&&this.touch.touchAction!==E.MOVEZOOM&&(this.ctx.lineWidth=this.zoom.level,this.ctx.strokeStyle=this.settings.gridColor,this.ctx.strokeRect(u.x+.5,u.y+.5,w-.5,v-.5))}resizeWindow(){this.zoom.zoomIn(),this.zoom.zoomOut(),this.reloadCanvas(),this.gui.guiElements.forEach(t=>{t.windowResize&&t.windowResize()}),this.gui.reloadGUI()}reloadCanvas(){this.setSizeCanvas(),this._redrawCanvas()}setSizeCanvas(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.settings.pixelSize=this.canvas.width/this.settings.gridSize}toggleGrid(){this.settings.showGrid=!this.settings.showGrid,this.resizeWindow()}_redrawCanvas(){const t=Mi(Jt(Kt(Oi(this),{x:this.settings.pixelSize,y:this.settings.pixelSize}))),s=Li(bi(Jt(Kt(Ni(this),{x:this.settings.pixelSize,y:this.settings.pixelSize}))),Dt,{x:this.settings.gridSize,y:this.settings.gridSize});this.paintCanvas({x:0,y:0},!1,"white",this.canvas.width,this.canvas.height);for(let r=t.x;r<s.x;r++)for(let a=t.y;a<s.y;a++)this.paintCanvas(st({x:r,y:a},this),this.settings.showGrid,this.data.pixels[r][a]);this.gui.reloadRelativeGUI()}}const me=["id"],Ae=H.defineComponent({__name:"DrawApp",props:{id:{default:"drawApp"},gridSize:{default:32},gridColor:{default:"000"},showGrid:{type:Boolean,default:!0}},setup(n,{expose:t}){const s=n;let r=H.ref(void 0);return H.onMounted(()=>{r.value=new xe(document.getElementById(s.id),{gridSize:s.gridSize,gridColor:s.gridColor,showGrid:s.showGrid})}),t({drawApp:r}),(a,c)=>(H.openBlock(),H.createElementBlock("canvas",{class:"canvasDrawing",style:{width:"100%",height:"100%"},id:a.id},null,8,me))}});q.DrawApp=Ae,Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});
